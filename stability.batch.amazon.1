# stability batch 1
# covers steps 1-9 on github.com/jessicamizzi/mothur-commands/blob/master/workflow.mdn
# setting directory, making contigs, summary, screening, unique, count, summary
# note - numbers match github repo steps, so numbering starts at 3.

##  Step 4 - set directory
# data will already be mounted in directory called work
set.dir(input=~/mothur/data, output=~/mothur/data)

## Step 4.5 - make contigs
# stability.files is already created and in /work
make.contigs(file=stability.files, processors=16)

## Step 5 - initial summary stats
summary.seqs(fasta=stability.trim.contigs.fasta)

## Step 6 - get rid of ambiguous base calls and setting max length to 325 (ambiguous)
screen.seqs(fasta=stability.trim.contigs.fasta, group=stability.contigs.groups, maxambig=0, maxlength=325)

## Step 7 - get rid of redundant sequences
unique.seqs(fasta=stability.trim.contigs.good.fasta)

## Step 8 - create a count table of current unique sequences
count.seqs(name=stability.trim.contigs.good.names, group=stability.contigs.good.groups)

## Step 9 - again, get summary of reads, now they are quality filtered and non redundant

summary.seqs(count=stability.trim.contigs.good.count_table)

## Step 10 - begin selecting for 16S files - align used primers to ecoli 16S and only include region between primers, file descriptions in workflow.md, step 10.

pcr.seqs(fasta=ecoli.16s.fasta, oligos=primer.oligos)

## Step 11 - align ecoli primer'ed region to silva database (have silva database in /data directory)

align.seqs(fasta=ecoli.16s.pcr.fasta, reference=~/mothur/data/silva.bacteria/silva.bacteria.fasta)

## Step 12 - get locations on fasta with ecoli alignment

summary.seqs(fasta=ecoli.16s.pcr.align)

## Step 13 - align sequences to reference alignment

pcr.seqs(fasta=~/mothur/data/silva.bacteria/silva.bacteria.fasta, start=13862, end=23444, keepdots=F, processors=16)

## Step 14 - summary of output

summary.seqs(fasta=~/mothur/data/silva.bacteria.pcr.fasta)

## Step 15 - Create alignment of customized reference alignment between current contigs file and reference alignment, then run summary.seqs on output.

align.seqs(fasta=stability.trim.contigs.good.unique.fasta, reference=~/mothur/data/silva.bacteria.pcr.fasta)
summary.seqs(fasta=stability.trim.contigs.good.unique.align, count=stability.trim.contigs.good.count_table

## Step 16 - 

screen.seqs(fasta=stability.trim.contigs.good.unique.align, count=stability.trim.contigs.good.count_table, summary=stability.trim.contigs.good.unique.summary, start=8, end=9582) # include maxhomp=8 if applicable
